<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>پنل مدیریت - تنظیمات سراسری</title>
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Vazirmatn", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #0f172a;
      color: #f8fafc;
    }

    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(1000px 700px at 90% 10%, rgba(59, 130, 246, 0.2), transparent 55%),
                  radial-gradient(900px 600px at 10% 85%, rgba(14, 165, 233, 0.18), transparent 60%),
                  linear-gradient(135deg, #0f172a, #1e293b);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: clamp(16px, 4vw, 48px);
      box-sizing: border-box;
    }

    .card {
      width: min(720px, 100%);
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(22px);
      -webkit-backdrop-filter: blur(22px);
      border-radius: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 24px 60px -32px rgba(15, 23, 42, 0.9);
      padding: clamp(20px, 4vw, 40px);
    }

    h1 {
      margin: 0 0 24px;
      font-size: clamp(24px, 4vw, 32px);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    h1 span.icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 42px;
      height: 42px;
      border-radius: 14px;
      background: linear-gradient(135deg, #fbbf24, #f97316);
      color: #1e293b;
      font-weight: 700;
      font-size: 20px;
    }

    form {
      display: grid;
      gap: 16px;
    }

    fieldset {
      border: none;
      padding: 0;
      margin: 0;
      display: grid;
      gap: 14px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 18px;
      padding: clamp(16px, 3vw, 28px);
      border: 1px solid rgba(148, 163, 184, 0.12);
    }

    fieldset legend {
      padding: 0 8px;
      font-weight: 700;
      font-size: 16px;
      margin-bottom: 12px;
      color: #fbbf24;
    }

    .field {
      display: grid;
      gap: 6px;
    }

    label {
      font-weight: 600;
      font-size: 14px;
      color: rgba(248, 250, 252, 0.85);
    }

    input[type="text"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      box-sizing: border-box;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: rgba(15, 23, 42, 0.6);
      color: inherit;
      font-size: 15px;
      padding: 10px 12px;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      resize: vertical;
      min-height: 44px;
    }

    textarea {
      min-height: 72px;
      line-height: 1.6;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: rgba(59, 130, 246, 0.7);
      box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
    }

    .actions {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 12px;
      justify-content: space-between;
      padding-top: 8px;
    }

    .meta {
      display: flex;
      flex-wrap: wrap;
      gap: 12px 24px;
      font-size: 13px;
      color: rgba(248, 250, 252, 0.6);
    }

    .btn-primary {
      border: none;
      border-radius: 14px;
      padding: 12px 28px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, #fbbf24, #f97316);
      color: #1f2937;
      box-shadow: 0 18px 40px -22px rgba(251, 191, 36, 0.65);
      transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
    }

    .btn-primary:hover:not([disabled]) {
      transform: translateY(-1px);
      box-shadow: 0 22px 46px -20px rgba(251, 191, 36, 0.72);
    }

    .btn-primary[disabled] {
      cursor: progress;
      opacity: 0.65;
    }

    .status {
      font-size: 14px;
      border-radius: 12px;
      padding: 10px 14px;
      background: rgba(14, 165, 233, 0.12);
      color: rgba(125, 211, 252, 0.95);
      border: 1px solid rgba(56, 189, 248, 0.25);
      transition: opacity 0.2s ease;
      margin: 0;
      min-height: 20px;
    }

    .status.error {
      background: rgba(248, 113, 113, 0.15);
      color: rgba(252, 165, 165, 0.95);
      border-color: rgba(248, 113, 113, 0.35);
    }

    .status.success {
      background: rgba(34, 197, 94, 0.12);
      color: rgba(187, 247, 208, 0.95);
      border-color: rgba(74, 222, 128, 0.25);
    }

    @media (max-width: 640px) {
      .actions {
        flex-direction: column;
        align-items: stretch;
      }

      .btn-primary {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1><span class="icon">⚙️</span> تنظیمات سراسری بازی</h1>
    <form id="admin-settings-form" autocomplete="off">
      <fieldset>
        <legend>عمومی</legend>
        <div class="field">
          <label for="settings-app-name">نام برنامه</label>
          <input id="settings-app-name" name="appName" data-key="appName" type="text" maxlength="120" placeholder="مثلاً Quiz WebApp Pro" />
        </div>
        <div class="field">
          <label for="settings-default-lang">زبان پیش‌فرض</label>
          <select id="settings-default-lang" name="defaultLang" data-key="defaultLang">
            <option value="fa">فارسی</option>
            <option value="en">English</option>
          </select>
        </div>
        <div class="field">
          <label for="settings-question-time">زمان هر سؤال (ثانیه)</label>
          <input id="settings-question-time" name="questionTimeSec" data-key="questionTimeSec" type="number" min="5" max="600" step="1" value="30" />
        </div>
        <div class="field">
          <label for="settings-max-questions">حداکثر تعداد سؤال در هر بازی</label>
          <input id="settings-max-questions" name="maxQuestionsPerMatch" data-key="maxQuestionsPerMatch" type="number" min="1" max="200" step="1" value="10" />
        </div>
      </fieldset>

      <fieldset>
        <legend>تسویه و بودجه</legend>
        <div class="field">
          <label for="settings-minimum-settlement">حداقل مبلغ تسویه (تومان)</label>
          <input id="settings-minimum-settlement" name="minimumSettlement" data-key="minimumSettlement" type="number" min="0" step="1000" value="0" />
        </div>
        <div class="field">
          <label for="settings-rounding-step">گام گرد کردن مبالغ</label>
          <input id="settings-rounding-step" name="roundingStep" data-key="roundingStep" type="number" min="1" step="1" value="1" />
        </div>
        <div class="field">
          <label for="settings-settlement-amounts">مبالغ پیشنهادی تسویه (با ویرگول یا خط جدید جدا کنید)</label>
          <textarea id="settings-settlement-amounts" name="settlementAmounts" data-key="settlementAmounts" placeholder="مثلاً 25000, 50000, 100000"></textarea>
        </div>
        <div class="field">
          <label for="settings-monthly-budget">بودجه ماهانه تبلیغات (تومان)</label>
          <input id="settings-monthly-budget" name="monthlyBudget" data-key="monthlyBudget" type="number" min="0" step="1000" value="0" />
        </div>
      </fieldset>

      <div class="actions">
        <p id="settings-status" class="status" role="status" aria-live="polite"></p>
        <div class="meta">
          <span>نسخه: <strong id="settings-version">—</strong></span>
          <span>آخرین بروزرسانی: <strong id="settings-updated-at">—</strong></span>
        </div>
        <button id="saveBtn" type="submit" class="btn-primary">ذخیره تغییرات</button>
      </div>
    </form>
  </div>

    <script>
const API = '/api/admin/settings';
const numKeys = ['questionTimeSec','maxQuestionsPerMatch','minimumSettlement','roundingStep','monthlyBudget'];

async function loadSettings(){
  const r = await fetch(API);
  if(!r.ok) throw new Error('GET failed');
  const { data = {} } = await r.json();
  for (const [k,v] of Object.entries(data)) {
    const el = document.querySelector(`[data-key="${k}"]`);
    if (!el) continue;
    el.value = Array.isArray(v) ? v.join(',') : (v ?? '');
  }
}

async function saveSettings(){
  const data = {};
  document.querySelectorAll('[data-key]').forEach(el=>{
    const k = el.dataset.key;
    let v = el.value ?? '';
    if (k === 'settlementAmounts') v = v.split(',').map(s=>+s.trim()).filter(n=>!isNaN(n));
    else if (numKeys.includes(k)) v = +v;
    data[k] = v;
  });
  const r = await fetch(API, {
    method: 'PUT',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ data })
  });
  if(!r.ok) throw new Error('PUT failed');
  alert('Saved ✅');
}

document.addEventListener('DOMContentLoaded', ()=>{
  loadSettings().catch(console.error);
  document.getElementById('saveBtn')?.addEventListener('click', (e)=>{
    e.preventDefault();
    saveSettings().catch(err=>{ console.error(err); alert('Save failed ❌'); });
  });
});
    </script>
</body>
</html>
